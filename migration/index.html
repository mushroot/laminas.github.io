<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Documentation on how to migrate to Laminas.">
    <link rel="shortcut icon" href="/img/trademark-laminas-foundation-rgb.svg">
    <title>Migrate to Laminas</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top" data-spy="scroll" data-target=".toc" data-offset="20">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="logo-link navbar-brand" href="http://laminas.org.cn/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://laminas.org.cn/" data-tooltip
           data-placement="bottom" title="Go to the Laminas Documentation">
            文档
        </a>

        <button type="button"
                class="navbar-toggler"
                data-toggle="collapse"
                data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown sub-project-selector">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            所有文档
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a href="/components/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-components-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>组件</strong><br>
                                        为企业级应用而生的组件
                                    </div>
                                </div>
                            </a>
                            <a href="/mvc/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-mvc-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>MVC</strong><br>
                                        企业级的MVC框架
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.mezzio.dev/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-mezzio-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Mezzio（官方）</strong><br>
                                        PSR-15 Middleware in Minutes
                                    </div>
                                </div>
                            </a>
                            <a href="https://api-tools.getlaminas.org/documentation" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-api-tools-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>API Tools（官方）</strong><br>
                                        Build RESTful APIs in Minutes
                                    </div>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item dropdown-item--secondardy" href="/migration/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        迁移到 Laminas
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item--secondardy" href="/tutorials/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        入门引导
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://docs.laminas.dev/" target="_blank" class="nav-link">官方文档（En）</a>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<header class="header">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-12">
                <h1 class="header__title">
                    迁移到 Laminas
                </h1>
            </div>
        </div>
    </div>
</header>

<div class="container"><div class="row">
    <main class="col-md-9 col-sm-12 content">
        <div class="toc">
            <h6 class="toc__headline">导航</h6>

            <ul class="toc__list">
                <li class="toc__entry"><a class="toc__link nav-link" href="#preparation">准备工作</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#install-laminas-migration">安装 laminas-migration</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#run-the-migration-command">运行 migration 命令</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#optional-verify-changes">验证修改 (可选)</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#install-dependencies">安装依赖</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#test">测试</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#post-migration-optional">提交迁移 (可选)</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#summary">总结</a></li>
            </ul>
        </div>

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">总览</a></li>
                <li class="breadcrumb-item active" aria-current="page">迁移到 Laminas</li>
            </ol>
        </nav>

        <h1>迁移到 Laminas</h1>

<p>
    Laminas 及其子项目是 <a href="https://github.com/zendframework">Zend Framework</a>
    及其子项目开源版本的延续，该项目将作为正式分支，原有官方项目将进行归档并逐渐废弃。
</p>

<blockquote>
    <p>
        在本文档中，我们提及的 "Zend Framework" 均表示最初由 Zend Framework 项目提供的包文件
        以及其子项目
        <strong>包括 <a href="https://apigility.org">Apigility</a> 或
        <a href="https://getexpressive.org">Expressive</a>.</strong>
    </p>
</blockquote>

<p>可以进行的迁移:</p>

<ul>
    <li>依赖 Zend Framework 项目，或者其组件的单个组件或者应用。</li>

    <li>依赖 Zend Framework 组件的库。</li>
</ul>

<h2 id="preparation">1. 准备工作</h2>

<h3 id="ensure-you-have-an-up-to-date-composer">确保你安装了最新版本的 Composer</h3>

<p>
    我们的插件依赖 <a href="https://getcomposer.org">Composer</a> 并需要 1.7.0 及以上版本。
    如果你不确定当前使用的版本，可以运行 <code>composer --version</code> 来查看版本。
    如果版本过低，运行 <code>composer self-update</code> 进行升级。
</p>

<p>
    （目前唯一的限制在于，我们默认你使用的是 Composer 安装的 Zend Framework。）
</p>

<h3 id="make-sure-your-code-is-under-version-control">
    确保你使用的版本控制软件管理的你当前代码
</h3>

<p>
    迁移工具会修改你的代码，升级模板，修改<code>composer.json</code>文件，移除
    <code>composer.lock</code> <code>vendor/</code> 以及其子目录，以及一些其他的更改。
    如果你想要在出问题后回滚你的代码，请务必确保你使用了版本控制软件来管理你的代码！
</p>

<p>
    我们推荐 <a href="https://git-scm.org">Git</a>.
    如果你的应用当前未使用版本公职软件，你可以安装 git 并进行如下操作:
</p>

<pre class="codehilite"><code class="language-bash">$ cd path/to/your/application
$ git init .
$ echo "vendor/" > .gitignore
$ git add .
$ git commit -m 'Initial import'</code></pre>

<p>接下来你就可以随时查看你对代码进行了哪些更改。</p>

<h2 id="install-laminas-migration">2. 安装 laminas-migration</h2>

<p>这里有三种安装方式:</p>

<ol>
    <li>通过 composer 的 require 命令 (推荐)</li>
    <li>直接 clone</li>
    <li>使用本地环境变量</li>
</ol>

<h3 id="via-a-global-composer-requirement">通过 composer 的 require 命令</h3>

<p>
    Composer 允许你通过全局方式调用安装包文件。如果你使用当前当时：
</p>

<pre class="codehilite"><code class="language-bash">$ composer global require laminas/laminas-migration</code></pre>

<p>
    这样做需要你确保环境变量 <code>$PATH</code> 指向了 Composer安装包的子目录
    <code>vendor/bin/</code>。你可以使用如下命令来查找已经配置好的目录：
</p>

<pre class="codehilite"><code class="language-bash">$ composer global config home</code></pre>

<blockquote>
    <h4 id="adding-to-the-path">添加环境变量</h4>

    <p>
        环境变量 <code>$PATH</code> 配置取决于你当前的操作系统。
    </p>

    <p>
        对于 Linux, Mac, 及其他类 *nix 系统来说，你可以在 profile 配置(e.g.,
        <code>$HOME/.bashrc</code>, <code>$HOME/.zshrc</code>,
        <code>$HOME/.profile</code>, etc.)文件中添加如下配置：
    </p>

    <pre class="codehilite language-bash"><code class="language-bash">
    export PATH={path to add}:$PATH
    </code></pre>

    <p>
        对于 Windows 系统来说操作会稍微复杂；参考：
        <a href="https://www.architectryan.com/2018/03/17/add-to-the-path-on-windows-10/">this HOWTO</a>
    </p>
</blockquote>

<h3 id="via-cloning">直接 clone</h3>

<p>Clone仓库:</p>

<pre class="codehilite"><code class="language-bash">$ git clone https://github.com/laminas/laminas-migration.git</code></pre>

<p>安装依赖:</p>

<pre class="codehilite"><code class="language-bash">$ cd laminas-migration
$ composer install</code></pre>

<p>
    目前，我们同样 <code>$PATH</code> 中添加了 <code>bin/</code> 目录，(参见以上
    <a href="#adding-to-the-path">添加环境变量部分</a>) 将脚本目录 <code>bin/laminas-migration</code>
    软连接到 <code>$PATH</code> 中，或者使用 shell 脚本来创建 <code>bin/laminas-migration</code>  的别名：
</p>

<pre class="codehilite"><code class="language-bash"># 添加到PATH:
$ export PATH=/path/to/laminas-migration/bin:$PATH
# 添加软连接:
$ cd $HOME/bin && ln -s /path/to/laminas-migration/bin/laminas-migration .
# 创建别名:
$ alias laminas-migration=/path/to/laminas-migration/bin/laminas-migration</code></pre>

<h2 id="run-the-migration-command">3. 运行迁移命令</h2>

<p>
    一单你安装了 laminas-migration 工具，进入你需要迁移项目的目录，运行：
</p>

<pre class="codehilite"><code class="language-bash">$ laminas-migration migrate</code></pre>

<p>
    你可能需要一次或者多次使用 <code>--exclude</code> 或 <code>-e</code> 参数
    来 <em>排除</em> 不需要重写的目录，或者使用 <code>--filter</code> 或 <code>-f</code>
    参数来使用正则表达式 <em>指定</em> 需要重写的文件。
</p>

<p>举个例子， 排除 <code>data/</code> 子目录, 可以运行:</p>

<pre class="codehilite"><code class="language-bash">$ laminas-migration migrate -e data</code></pre>

<blockquote>
    <h4 id="migrating-the-conservative-way">保守的迁移方式</h4>
    <p>
        如果你有升级路径的限制，并且不想将任何包升级到最新的版本，你可能需要使用 <code>--keep-locked-versions</code>
        来确保<code>composer.json</code>中<em>所有</em>的包都将从 <code>composer.lock</code> 中获取版本信息来安装。
    </p>
    <p>
        我们鼓励你采用 <em>非保守</em> 的方式来迁移，以避免因为使用旧版本的包二导致迁移laminas中存在的问题。
    </p>
    <p>
        <strong>如果你使用这种方式升级之后遇到了问题，我们将不会解决方案，因此我们强烈建议你升级到最新版。</strong>
    </p>

    <pre class="codehilite"><code class="language-bash">$ laminas-migration migrate -e data --keep-locked-versions</code></pre>
</blockquote>

<p>我们可以通过命令查看其他可用的方法:</p>

<pre class="codehilite"><code class="language-bash">$ laminas-migration help migrate</code></pre>

<h2 id="optional-verify-changes">4. 验证修改 <small>(可选)</small></h2>

<p>
    此时，你可以查看进行的更改。例如，如果你使用git，你可以使用如下命令来查看更改：
</p>

<pre class="codehilite"><code class="language-bash">$ git diff</code></pre>

<p>你将会看见进行如下更改:</p>

<ul>
    <li>重名了了ZF组件的文件或者类。例如<code>My\Models\ZendMailTransport</code>
        重命名成了 <code>My\Models\LaminasMailTransport</code>。
        这样的重命名方式通常来说是可取的，和这个类有关的所有引用也将会被重写。
        然而，如果有外部代码依赖他，同样也需要去验证。</li>

    <li>配置的名称也将会被修改。其中大多数的更改是为了匹配 Laminas 库本身。
        但是还是需要你检查其中是否包含了你自定义代码的部分。</li>
</ul>


<h2 id="install-dependencies">5. 安装依赖</h2>

<p>
    一旦迁移并且执行了相关验证后，就可以开始安装依赖了：
</p>

<pre class="codehilite"><code class="language-bash">$ composer install</code></pre>

<h2 id="test">6. 测试</h2>

<p>
    运行单元测试，并执行端到端的测试，无论如何都要使用一些方式来验证你的应用。
</p>

<p>有任何不能执行的地方，都可以将其细节部分报告给我们：</p>

<ul>
    <li>在你出现问题的特定包中报告给我们。</li>
    <li>或者通过<a href="https://laminas.dev/chat/">Laminas Slack</a> 的 #laminas-issues 渠道。 </li>
</ul>

<h2 id="post-migration-optional">提交迁移 <small>(可选)</small></h2>

<p>
  之前我们使用了 <code>--keep-locked-versions</code> 参数,
  你肯定需要对比 <code>composer.json</code> 以便恢复旧的程序包
  以及移除迁移之前的程序使用的不必要了程序包。
  清理完 <code>composer.json</code> 之后，你可能需要使用如下的命令来更新
  <code>composer.lock</code> ：
  <pre class="codehilite"><code class="language-bash">$ composer update --lock</code></pre>
</p>

<h2 id="summary">总结</h2>

<p>迁移步骤如下:</p>

<pre class="codehilite"><code class="language-bash">$ composer global require laminas/laminas-migration
$ cd some/project
$ laminas-migration migrate # maybe with -e data or -e data/cache
$ composer install</code></pre>

<p>问题咨询</p>

<ul>
    <li><a href="./faq/">查询FAQ</a></li>
    <li><a href="https://laminas.dev/chat/">Visit the Slack</a></li>
    <li><a href="https://discourse.laminas.dev/">Visit the Forums</a></li>
</ul>
        </main>

        <div class="col-md-3 col-sm-12 sidebar">
            <div class="subnavigation hidden-print">
                <h4 class="subnavigation__title"><a href="/migration/">迁移到 Laminas</a></h4>

                <ul class="subnavigation__list">
                    <li class="subnavigation__list-item subnavigation__list-item--active">
                        <a class="subnavigation__link" href="/migration/">介绍</a>
                    </li>
                    <li class="subnavigation__list-item">
                        <a class="subnavigation__link" href="./faq/">FAQ</a>
                    </li>
                </ul>
            </div>
        </div>
</div></div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://getmezzio.org/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://getlaminas.org/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>

            <div class="col-md-6">
                <h4 class="footer__headline">Copyright</h4>
                <p>
                    &copy; 2019-2020 by <a href="https://getlaminas.org/">The Laminas Project</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
    let base_url = '/',
        project = 'mvc',
        siteName = 'Documentation';
</script>
<script src="/js/scripts.js"></script>
</body>
</html>
